unit Udm.UX;

interface

uses
  System.SysUtils,
  System.Classes, System.Actions, Vcl.ActnList, System.Win.ScktComp,
  Vcl.ExtCtrls;

type
  Tdm_UX = class(TDataModule)
    ActionLst_Client: TActionList;
    Act_Switcher: TAction;
    CSock_Main: TClientSocket;
    Timer_AutoReconnect: TTimer;
    procedure Act_SwitcherExecute(Sender: TObject);
    procedure Timer_AutoReconnectTimer(Sender: TObject);
    procedure DataModuleDestroy(Sender: TObject);
    procedure CSock_MainRead(Sender: TObject; Socket: TCustomWinSocket);
    procedure CSock_MainError(Sender: TObject; Socket: TCustomWinSocket;
      ErrorEvent: TErrorEvent; var ErrorCode: Integer);
    procedure CSock_MainDisconnect(Sender: TObject; Socket: TCustomWinSocket);
    procedure CSock_MainConnecting(Sender: TObject; Socket: TCustomWinSocket);
    procedure CSock_MainConnect(Sender: TObject; Socket: TCustomWinSocket);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  dm_UX: Tdm_UX;

implementation

{%CLASSGROUP 'Vcl.Controls.TControl'}

{$R *.dfm}

procedure Tdm_UX.Act_SwitcherExecute(Sender: TObject);
begin
//
end;

procedure Tdm_UX.CSock_MainConnect(Sender: TObject; Socket: TCustomWinSocket);
begin
  StatusBar_APP.Panels.Items[1].Text := 'Client is Connected on Server IP: ' +Socket.LocalHost;
  Btn_Connect.Enabled:= True;
end;

procedure Tdm_UX.CSock_MainConnecting(Sender: TObject;
  Socket: TCustomWinSocket);
begin
  StatusBar_APP.Panels.Items[1].Text := 'Connecting...';
  Btn_Connect.Enabled:= False;
end;

procedure Tdm_UX.CSock_MainDisconnect(Sender: TObject;
  Socket: TCustomWinSocket);
begin
  StatusBar_APP.Panels.Items[1].Text := 'Client is Stopped';
//==========
  Btn_Connect.Caption := 'Start Client';
  Edt_Port.Enabled:= True;
  Edt_Host.Enabled:= True;
  Btn_Connect.Tag := 0;
end;

procedure Tdm_UX.CSock_MainError(Sender: TObject; Socket: TCustomWinSocket;
  ErrorEvent: TErrorEvent; var ErrorCode: Integer);
begin
  ErrorCode := 0;
  StatusBar_APP.Panels.Items[1].Text := 'Connection Error !!';
//==========
  Btn_Connect.Enabled:= True;
  Btn_Connect.Caption := 'Start Client';
  Edt_Port.Enabled:= True;
  Edt_Host.Enabled:= True;
  Btn_Connect.Tag := 0;
end;

procedure Tdm_UX.CSock_MainRead(Sender: TObject; Socket: TCustomWinSocket);
var
  StrCommand: string;
begin
  StrCommand := Socket.ReceiveText;
//=======
  if StrCommand = '22' then
  begin
    CSock_Main.Active := False;
  end;
//=======
end;

procedure Tdm_UX.DataModuleDestroy(Sender: TObject);
begin
  if CSock_Main.Active then CSock_Main.Active := False;
end;

procedure Tdm_UX.Timer_AutoReconnectTimer(Sender: TObject);
begin
 if not CSock_Main.Active then
    CSock_Main.Active := True;
end;

end.
